{% extends 'custodia/base.html' %}
{% load tz %}
{% load static %}

{% block title %}Resultado - Cadeia de Cust√≥dia #{{ custodia.numero_documento }}{% endblock %}

{% block content %}
<div class="result-container">
    <div class="success-header">
        <h2>‚úì Cadeia de Cust√≥dia Criada com Sucesso!</h2>
        <p class="document-number">N√∫mero do Documento: <strong>{{ custodia.numero_documento }}</strong></p>
    </div>

    <div class="result-section">
        <h3>Hash SHA-256 da Pasta</h3>
        <div class="hash-display">
            <code class="hash-code">{{ custodia.hash_pasta }}</code>
            <button class="btn-copy" onclick="copiarHash()" title="Copiar hash">
                üìã Copiar
            </button>
        </div>
        <p class="hash-info">
            Este hash garante a integridade dos arquivos. Qualquer altera√ß√£o resultar√° em um hash diferente.
        </p>
    </div>

    <div class="result-grid">
        <div class="result-card">
            <h4>Informa√ß√µes do Policial</h4>
            <p><strong>Nome:</strong> {{ custodia.policial.nome_completo }}</p>
            <p><strong>Matr√≠cula:</strong> {{ custodia.policial.matricula }}</p>
            <p><strong>Cargo:</strong> {{ custodia.policial.cargo|default:"N√£o informado" }}</p>
            <p><strong>Delegacia:</strong> {{ custodia.policial.delegacia|default:"N√£o informado" }}</p>
        </div>

        <div class="result-card">
            <h4>Informa√ß√µes do Caso</h4>
            <p><strong>Procedimento:</strong> {{ custodia.caso.numero_procedimento }}</p>
            <p><strong>Local:</strong> {{ custodia.caso.local_crime }}</p>
            <p><strong>Data Coleta:</strong> {{ custodia.caso.data_coleta|localtime|date:"d/m/Y H:i" }}</p>
        </div>

        <div class="result-card">
            <h4>Estat√≠sticas</h4>
            <p><strong>Total de Arquivos:</strong> {{ custodia.total_arquivos }}</p>
            <p><strong>Tamanho Total:</strong> {{ tamanho_formatado }}</p>
            <p><strong>Data de Cria√ß√£o:</strong> {{ custodia.data_criacao|localtime|date:"d/m/Y H:i" }}</p>
        </div>
    </div>

    <div class="result-section">
        <h3>Documento PDF</h3>
        {% if pdf_disponivel %}
            <p>O documento PDF foi gerado com sucesso e cont√©m todas as informa√ß√µes da cadeia de cust√≥dia.</p>
            <div class="pdf-actions">
                <a href="{% url 'custodia:download_pdf' custodia.id %}" class="btn-primary" download>
                    üìÑ Baixar PDF
                </a>
                <a href="{% url 'custodia:detalhes' custodia.id %}" class="btn-secondary">
                    Ver Detalhes Completos
                </a>
            </div>
        {% else %}
            <div class="alert alert-warning">
                O PDF ainda est√° sendo gerado ou houve um erro. Tente novamente mais tarde.
            </div>
        {% endif %}
    </div>

    <div class="result-actions">
        <a href="{% url 'custodia:index' %}" class="btn-primary">Criar Nova Cust√≥dia</a>
        <a href="{% url 'custodia:lista' %}" class="btn-secondary">Ver Todas as Cust√≥dias</a>
    </div>
</div>

<script>
function copiarHash() {
    const hash = '{{ custodia.hash_pasta }}';
    navigator.clipboard.writeText(hash).then(function() {
        alert('Hash copiado para a √°rea de transfer√™ncia!');
    }, function(err) {
        console.error('Erro ao copiar: ', err);
    });
}
</script>
{% endblock %}
